## 数据链路层

基本:数据链路层为网路层服务

从这一章开始真正的讲网络的协议

功能:差错检测和纠错,寻址

MAC 协议及性能分析

---

题外话:4G:由国家通信部统一发放牌照

- TD-LTE
- FDD-LTE
- 原理:正交频分复用(抗干扰性极高)
- OFDM:多载波调制技术

5G:

---

IEEE 局域网标准

802.1 网络互连:将局域网和 IPV6 和 IPV4 连接

802.2:逻辑链路控制:提供面向连接的数据服务

最常用的 802.3

802.11:wifi主要采用

802.4,802.5:SONET环形网络

Token :令牌保证数据发送无冲突

802.1:网络结构,寻找

---

## 数据链路层服务:

- 成帧 framing
    - 把数据报封装成帧,加上报头header和报尾trailer(帧格式) 

- 链路访问 link access 

    - 当多个节点共享媒介时,负责信道的访问控制(多种方法) 

    - 帧的报头中使用“MAC”地址以识别源节点和目的节点 
    - 与IP地址不同! 

- 相邻节点之间的可靠数据传输 reliable delivery
    - 在低位差链路上很少使用(如光纤链路,某些双绞线链路) 
    - 无线链路经常使用(确认&重传机制):高差错率 

-  流量控制 flow control

    - 有限缓存，在相邻的发送和接收节点交换信息、调节发送速率  

    - 与运输层的流量控制不重复 

-  差错检测 error detection

    - 信号衰减、电磁干扰噪声等导致比特(位)差错   

    - 接收节点检测差错，并通知发送节点重传或丢弃帧
    -  在链路层非常普及，比传输层更复杂，通过 硬件实现(快速) 

- 差错纠正 error correction
    - 接收节点不仅能检测而且能够纠正比特差错,不必重传(编码方法)   
    - 硬件控制(循环冗余校验码)
    - 预测前后帧,自动修正	

- 半双工 half-duplex 和 全双工 full-duplex

    - 半双工传输时，链路两端的节点不能同时传输和接收 

    - 现有链路大多是全双工模式

    - 全双工就是相当于两个独立的信道(使用较多)

---
### 数据链路层传输的是 IP 数据报封装成的帧,单位是帧

数据链路层就像个数字管道(datalink)

早期的协议称为通信规程(procedure)。因此 在数据链路层，规程和协议是同义语

#### 成帧同步 framing:

帧同步:决定数据帧的开始和结束,限制了最大帧长.MTU

#### 透明:

是指我们每一层的协议是在同等层实现的,实现的是透明的服务

透明的服务:我不需要知道你协议的实现,我只要知道数据就行

### 如何实现透明的传输

如何完整的表示一个帧?

- #### bit填充法

    ![image-20191012140611773](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-060612.png)

    既包含 IP 数据报的首部和尾部,又包含数据帧的首部和尾部

    加上一个转义字符

    ![image-20191012140735976](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-060736.png)

- 字符计数法:在首部设立长度字段,接收方根据长度字段决定接受的数量



- 时钟成帧法:接收方通过首部一段固定的字段控制一个帧的接受,在很多光纤传输中

### 差错检测和纠错

EDC:差误检错码

### 差错检测方法

奇偶校验码

校验和法TCP

CRC 循环冗余校验码:广泛用于 802.11 WiFi

![image-20191012141757941](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-061758.png)

  ![image-20191012142318701](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-062318.png)

![image-20191012144143173](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-064143.png)

---

## PPP协议

1.  一个发送方, 一个接收方, 单条独享链路: 比广 播链路易处理
     ● 没有媒体访问控制 Media Access Control (信道独享)

     ● 不需要明确的 MAC 地址
     ● 例如, 拨号上网, ADSL线路 

2. 常见的点对点 

    ●  PPP (point-to-point protocol)(现常用) 

    ●  HDLC: High level data link control (在协议栈中数据 链路被认为是 “high layer” ! )(早期常用) 

---

### PPP 设计

1. 成帧packetframing:把网络层数据报封装在数据链路帧 里 

    ● 可以同时承载任何网络层协议的网络层数据(不仅是IP) 

    ● 具有向上复用能力

2. 比特透明bittransparency:必须能在数据域中承载任何比特模式

3. 差错检测errordetection(无需纠错) 

4. 连接活性connectionliveness:能检测出链路故障，并向 网络层发关于链路故障的信号 

5.  网络层地址协调networklayeraddressnegotiation:终点 能学习/配置各自的网络层地址 

#### ~~不需要实现的~~:

- 差错纠正/恢复 

- 流量控制 

- 以太网一般有流量控制(交换机 发出pause帧) 

- 排序:乱序递送是允许的 
- 支持多点链路 (e.g., 轮询polling) 

---

- PPP:将 IP 数据报封装成多个 PPP 帧

- NVP:一个协议可以支持不同的网络层协议(向上)

- LCP:建立、配置和测试数据链路。(向下)

### PPP 协议的数据帧

- Flag：分隔符（framing)

- Address：设为固定值 111 only one option) 

- Control：设为固定值 0000,1; in the future possible multiple control fields

- Protocol：帧递送的上层协议的类型（eg, PPP-LCP. P, IPCP, etc )
-  info：承载的上层数据，最大长度 1500 字节 a check：差错检测的循环冗余校验 CRC,2 或 4 字节

![image-20191012145139345](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-065139.png)

---

### 透明传输技术

字节填充:0x7D

bit 填充:01111010~01111100 …..01111110

HDCL:连续 5 个 1 的时候在后面填充一个 0

---

### **PPP** 协议的工作状态

- 建立物理连接状态
- 利用 LCP 配置链路(LCP 封装到 PPP 数据帧中)
- 利用 NCP 进行网络控制

- NCP 释放网络层,LCP 释放链路层

---

## 广播信道的数据链路层

广播链路 broadcast

802.11 无线 WiFi

802.3 拨号上网

### 多路访问协议

如何实现一个共享的信道实现分布式算法,

- 一个共享的广播信道
- 两个或以上同时发送数据

---

### MAC 协议(非常重要)

- 信道划分协议ChannelPartitioning

    公平当是效率不高

- 随机访问协议RandomAccess

    802.3

- 轮流协议“Takingturns”

    令牌控制

---

![image-20191012151646021](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-071646.png)

- 网卡工作在数据链路层

- MAC 地址工作在数据链路层
- 链路层协议在适配器(网卡 NIC)上实现

---

## 3.使用广播信道的数据链路层:802.3



## 4.使用广播信道的以太网:以太网的利用率,以太网的 MAC 层

## 以太帧:

### ![image-20191023135410161](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-23-055410.png)

---

## 多接口网卡

----

# 考试重点

---

1. 所谓链路（ink）就是从一个结点到相邻结点的一段物理线路（有线或无线），而中间没有任何其他的交换结点。在进行数据通信时，两台计算机之间的通信路径往往要经过许多段这样的链路。可见链路只是一条路径的组成部分。

2. 数据链路（data link）则是另一个概念。这是因为当需要在一条线路上传送数据时，除了必须有一条物理线路外，还必须有一些必要的通信协议来控制这些数据的传输（这将在后面几节讨论）。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。

3. 数据链路层把网络层交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据取出并上交给网络层。在互联网中，网络层协议数据单元就是 IP 数据报（或简称为数据报、分组或包）。

4. 数据链路层协议有许多种，但有三个基本问题则是共同的。这三个基本问题是：封装成帧、透明传输和差错检测。下面分别讨论这三个基本问题。

    1. 封装成帧（framing）就是在一段数据的前后分别添加首部和尾部，这样就构成了一个帧。接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束.

        ![image-20191023135843730](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-23-055843.png)

    2. **透明成帧**,当传送的帧是用文本文件组成的帧时（文本文件中的字符都是从键盘上输入的），其数据部分显然不会出现像 SOH 或 EOT 这样的帧定界控制字符。可见不管从键盘上输入什么字符都可以放在这样的帧中传输过去，因此这样的传输就是透明传输。

        ![image-20191023140023357](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-23-060023.png)

    3. **差错检测**:目前在数据链路层广泛使用了循环冗余检验 CRC (Cyclic Redundancy Check）的检错技术。

        ![image-20191023140224535](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-23-060225.png)

    4. 可靠传输:

        1. 帧丢失：收到【#11-#3]（丢失【#2】）。
        2. 帧重复：收到#1] H#2] - [#2] - [#3]（收到两个【#2】）。
        3. 帧失序：收到【#1] [#3] - [#2]（后发送的帧反而先到达了接收端，这与一般数据链路层的传输概念不一样）。
        4. 解决方法:帧编号、确认和重传机制.
        5. 对于通信质量良好的有线传输链路，数据链路层协议不使用确认和重传机制，即不要求数据链路层向上提供可靠传输的服务。如果在数据链路层传输数据时出现了差错并且需要进行改正，那么改正差错的任务就由上层协议（例如，运输层的 TCP 协议）来完成。

    5. PPP:点对点传输协议

        1. 多种网络层协议 PPP 协议必须能够在在同一条物理链路上同时支持多种网络层协议（如 IP 和 IPX 等）的运行。当点对点链路所连接的是局域网或路由器时，PPP 协议必须同时支持在链路所连接的局域网或路由器上运行的各种网络层协议。

        2. 常见传送单元 1500bit(不包含首部和尾部)only IP 数据报

        3. 网络层地址协商:实体能够通过协商知道或能够配置彼此的网络层地址。

        4. 数据压缩协商 PPP 协议必须提供一种方法来协商使用数据压缩算法。但 PP 协议并不要求将数据压缩算法进行标准化

        5. (2) 一个用来建立、配置和测试数据链路连接的链路控制协议 LCP (Link Control Protocol）。通信的双方可协商一些选项。在 RFC1661 中定义了 11 种类型的 LCP 分组

        6.  (3) 一套网络控制协议 NCP (Network Control Protocol) °，其中的每一个协议支持不同的网络层协议，如 IP、OSI 的网络层、Decnet，以及 Appletalk 等。

        7. TCP 协议是面向字符的发送方式实现透明传输

        8. PPP 是面向 bit 的压缩方式实现透明传输(兼容性)只要发现有 5 个连续 1, 则立即填入一个 0。

            ![image-20191023141606060](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-23-061606.png)

    6. 使用广播信道的数据链路层(重点)

        1. 特点:一个发,多个接收,重点在解决冲突问题
        2. 局域网
            1. ![image-20191023141808111](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-23-061808.png)
            2. FBDI 光纤双环网
            3. 有线网中主要采用 802.3 协议
            4. 信道的共享:
                1. 静态划分:波分复用,码分复用,频分复用,时分复用
                2. 动态划分:随机接入的特点是所有的用户可随机地发送信息。但如果恰巧有两或更多的用户在同一时刻发送信息，那么在共享媒体上就要产生碰撞（即发生了冲突），使得这些用户的发送都失败。因此，必须有解决碰撞的网络协议。
                3. 受控接入(令牌)的特点是用户不能随机地发送信息而必须服从一定的控制。这类的典型代表有分散控制的令牌环局域网和集中控制的多点线路探询（polling）或称为轮询。



