## 数据链路层

基本:数据链路层为网路层服务

从这一章开始真正的讲网络的协议

功能:差错检测和纠错,寻址

MAC 协议及性能分析

---

题外话:4G:由国家通信部统一发放牌照

- TD-LTE
- FDD-LTE
- 原理:正交频分复用(抗干扰性极高)
- OFDM:多载波调制技术

5G:

---

IEEE 局域网标准

802.1 网络互连:将局域网和 IPV6 和 IPV4 连接

802.2:逻辑链路控制:提供面向连接的数据服务

最常用的 802.3

802.11:wifi主要采用

802.4,802.5:SONET环形网络

Token :令牌保证数据发送无冲突

802.1:网络结构,寻找

---

## 数据链路层服务:

- 成帧 framing
    - 把数据报封装成帧,加上报头header和报尾trailer(帧格式) 

- 链路访问 link access 

    - 当多个节点共享媒介时,负责信道的访问控制(多种方法) 

    - 帧的报头中使用“MAC”地址以识别源节点和目的节点 
    - 与IP地址不同! 

- 相邻节点之间的可靠数据传输 reliable delivery
    - 在低位差链路上很少使用(如光纤链路,某些双绞线链路) 
    - 无线链路经常使用(确认&重传机制):高差错率 

-  流量控制 flow control

    - 有限缓存，在相邻的发送和接收节点交换信息、调节发送速率  

    - 与运输层的流量控制不重复 

-  差错检测 error detection

    - 信号衰减、电磁干扰噪声等导致比特(位)差错   

    - 接收节点检测差错，并通知发送节点重传或丢弃帧
    -  在链路层非常普及，比传输层更复杂，通过 硬件实现(快速) 

- 差错纠正 error correction
    - 接收节点不仅能检测而且能够纠正比特差错,不必重传(编码方法)   
    - 硬件控制(循环冗余校验码)
    - 预测前后帧,自动修正	

- 半双工 half-duplex 和 全双工 full-duplex

    - 半双工传输时，链路两端的节点不能同时传输和接收 

    - 现有链路大多是全双工模式

    - 全双工就是相当于两个独立的信道(使用较多)

---
### 数据链路层传输的是 IP 数据报封装成的帧,单位是帧

数据链路层就像个数字管道(datalink)

早期的协议称为通信规程(procedure)。因此 在数据链路层，规程和协议是同义语

#### 成帧同步 framing:

帧同步:决定数据帧的开始和结束,限制了最大帧长.MTU

#### 透明:

是指我们每一层的协议是在同等层实现的,实现的是透明的服务

透明的服务:我不需要知道你协议的实现,我只要知道数据就行

### 如何实现透明的传输

如何完整的表示一个帧?

- #### bit填充法

    ![image-20191012140611773](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-060612.png)

    既包含 IP 数据报的首部和尾部,又包含数据帧的首部和尾部

    加上一个转义字符

    ![image-20191012140735976](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-060736.png)

- 字符计数法:在首部设立长度字段,接收方根据长度字段决定接受的数量



- 时钟成帧法:接收方通过首部一段固定的字段控制一个帧的接受,在很多光纤传输中

### 差错检测和纠错

EDC:差误检错码

### 差错检测方法

奇偶校验码

校验和法TCP

CRC 循环冗余校验码:广泛用于 802.11 WiFi

![image-20191012141757941](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-061758.png)

  ![image-20191012142318701](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-062318.png)

![image-20191012144143173](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-064143.png)

---

### PPP协议

1.  一个发送方, 一个接收方, 单条独享链路: 比广 播链路易处理
     ● 没有媒体访问控制 Media Access Control (信道独享)

     ● 不需要明确的 MAC 地址
     ● 例如, 拨号上网, ADSL线路 

2. 常见的点对点 

    ●  PPP (point-to-point protocol)(现常用) 

    ●  HDLC: High level data link control (在协议栈中数据 链路被认为是 “high layer” ! )(早期常用) 

---

### PPP 设计

1. 成帧packetframing:把网络层数据报封装在数据链路帧 里 

    ● 可以同时承载任何网络层协议的网络层数据(不仅是IP) 

    ● 具有向上复用能力

2. 比特透明bittransparency:必须能在数据域中承载任何比特模式

3. 差错检测errordetection(无需纠错) 

4. 连接活性connectionliveness:能检测出链路故障，并向 网络层发关于链路故障的信号 

5.  网络层地址协调networklayeraddressnegotiation:终点 能学习/配置各自的网络层地址 

#### ~~不需要实现的~~:

- 差错纠正/恢复 

- 流量控制 

- 以太网一般有流量控制(交换机 发出pause帧) 

- 排序:乱序递送是允许的 
- 支持多点链路 (e.g., 轮询polling) 

---

- PPP:将 IP 数据报封装成多个 PPP 帧

- NVP:一个协议可以支持不同的网络层协议(向上)

- LCP:建立、配置和测试数据链路。(向下)

### PPP 协议的数据帧

- Flag：分隔符（framing)

- Address：设为固定值 111 only one option) 

- Control：设为固定值 0000,1; in the future possible multiple control fields

- Protocol：帧递送的上层协议的类型（eg, PPP-LCP. P, IPCP, etc )
-  info：承载的上层数据，最大长度 1500 字节 a check：差错检测的循环冗余校验 CRC,2 或 4 字节

![image-20191012145139345](https://cy-1256894686.cos.ap-beijing.myqcloud.com/cy/2019-10-12-065139.png)

---

### 透明传输技术

字节填充:0x7D

bit 填充:01111010~01111100 …..01111110

HDCL:连续 5 个 1 的时候在后面填充一个 0

---

### **PPP** 协议的工作状态

- 建立物理连接状态
- 利用 LCP 配置链路(LCP 封装到 PPP 数据帧中)
- 利用 NCP 进行网络控制

- NCP 释放网络层,LCP 释放链路层

---

### 广播信道的数据链路层

广播链路 broadcast

802.11 无线 WiFi

802.3 拨号上网



